{
    "vfp_id": "vfp_00386",
    "project_name": "cantina_coinbase_flywheel_sep2025.pdf",
    "findings": [
        {
            "id": 13,
            "category": {
                "1": [
                    "CWE-664"
                ],
                "2": [
                    "CWE-400"
                ],
                "3": [
                    "CWE-405"
                ],
                "4": [
                    "CWE-1050"
                ]
            },
            "title": "Potential out-of-gas issue in future hooks implementations",
            "description": "The createCampaign() function allows arbitrary hook contracts that may write unbounded data in _onCreateCampaign(). The cause is lack of constraints on hook behavior. Future hook implementations could accumulate storage, leading to out-of-gas errors when iterating over data. The impact is potential denial of service in dependent functions, especially as the number of campaigns grows.\n",
            "severity": "Informational",
            "location": [],
            "files": [
                "flywheel/src/CampaignHooks.sol"
            ]
        }
    ],
    "affected_files": {
        "CampaignHooks.sol": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.29;\n\nimport {Flywheel} from \"./Flywheel.sol\";\n\n/// @title CampaignHooks\n///\n/// @notice Abstract contract for campaign hooks that process campaign attributions\nabstract contract CampaignHooks {\n    /// @notice Address of the flywheel contract\n    Flywheel public immutable flywheel;\n\n    /// @notice Thrown when a function is not supported\n    error Unsupported();\n\n    /// @notice Modifier to restrict function access to flywheel only\n    modifier onlyFlywheel() {\n        require(msg.sender == address(flywheel));\n        _;\n    }\n\n    /// @notice Constructor for CampaignHooks\n    ///\n    /// @param flywheel_ Address of the flywheel contract\n    constructor(address flywheel_) {\n        flywheel = Flywheel(flywheel_);\n    }\n\n    /// @notice Creates a campaign in the hook\n    ///\n    /// @param campaign Address of the campaign\n    /// @param nonce Nonce used to create the campaign\n    /// @param hookData Data for the campaign hook\n    ///\n    /// @dev Only callable by the flywheel contract\n    function onCreateCampaign(address campaign, uint256 nonce, bytes calldata hookData) external onlyFlywheel {\n        _onCreateCampaign(campaign, nonce, hookData);\n    }\n\n    /// @notice Processes immediate payouts for a campaign\n    ///\n    /// @param sender Address of the sender\n    /// @param campaign Address of the campaign\n    /// @param token Address of the token to be sent\n    /// @param hookData Data for the campaign hook\n    ///\n    /// @return payouts Array of payouts to be sent\n    /// @return immediateFees Array of fees to be send immediately\n    /// @return delayedFees Array of fees to be allocated\n    ///\n    /// @dev Only callable by the flywheel contract\n    function onSend(address sender, address campaign, address token, bytes calldata hookData)\n        external\n        onlyFlywheel\n        returns (\n            Flywheel.Payout[] memory payouts,\n            Flywheel.Payout[] memory immediateFees,\n            Flywheel.Allocation[] memory delayedFees\n        )\n    {\n        return _onSend(sender, campaign, token, hookData);\n    }\n\n    /// @notice Processes attribution for a campaign\n    ///\n    /// @param sender Address of the sender\n    /// @param campaign Address of the campaign\n    /// @param token Address of the token to be distributed\n    /// @param hookData Data for the campaign hook\n    ///\n    /// @return allocations Array of allocations to be distributed\n    ///\n    /// @dev Only callable by the flywheel contract\n    function onAllocate(address sender, address campaign, address token, bytes calldata hookData)\n        external\n        onlyFlywheel\n        returns (Flywheel.Allocation[] memory allocations)\n    {\n        return _onAllocate(sender, campaign, token, hookData);\n    }\n\n    /// @notice Deallocates allocated rewards from a key for a campaign\n    ///\n    /// @param sender Address of the sender\n    /// @param campaign Address of the campaign\n    /// @param token Address of the token to deallocate from the key\n    /// @param hookData Data for the campaign hook\n    ///\n    /// @return allocations Array of allocations to be deallocated\n    ///\n    /// @dev Only callable by the flywheel contract\n    function onDeallocate(address sender, address campaign, address token, bytes calldata hookData)\n        external\n        onlyFlywheel\n        returns (Flywheel.Allocation[] memory allocations)\n    {\n        return _onDeallocate(sender, campaign, token, hookData);\n    }\n\n    /// @notice Distributes payouts for a campaign\n    ///\n    /// @param sender Address of the sender\n    /// @param campaign Address of the campaign\n    /// @param token Address of the token to be distributed\n    /// @param hookData Data for the campaign hook\n    ///\n    /// @return distributions Array of distributions to be distributed\n    /// @return immediateFees Array of fees to be sent immediately\n    /// @return delayedFees Array of fees to be allocated\n    ///\n    /// @dev Only callable by the flywheel contract\n    function onDistribute(address sender, address campaign, address token, bytes calldata hookData)\n        external\n        onlyFlywheel\n        returns (\n            Flywheel.Distribution[] memory distributions,\n            Flywheel.Payout[] memory immediateFees,\n            Flywheel.Allocation[] memory delayedFees\n        )\n    {\n        return _onDistribute(sender, campaign, token, hookData);\n    }\n\n    /// @notice Distribute fees earned from a campaign\n    ///\n    /// @param sender Address of the sender\n    /// @param campaign Address of the campaign\n    /// @param token Address of the token to collect fees from\n    /// @param hookData Data for the campaign hook\n    ///\n    /// @return distributions Array of distributions for the fees\n    ///\n    /// @dev Only callable by the flywheel contract\n    function onDistributeFees(address sender, address campaign, address token, bytes calldata hookData)\n        external\n        onlyFlywheel\n        returns (Flywheel.Distribution[] memory distributions)\n    {\n        return _onDistributeFees(sender, campaign, token, hookData);\n    }\n\n    /// @notice Allows sponsor to withdraw remaining tokens from a finalized campaign\n    ///\n    /// @param sender Address of the sender\n    /// @param campaign Address of the campaign\n    /// @param token Address of the token to withdraw\n    /// @param hookData Data for the campaign hook\n    ///\n    /// @return payout The payout to be withdrawn\n    ///\n    /// @dev Only callable by the flywheel contract\n    function onWithdrawFunds(address sender, address campaign, address token, bytes calldata hookData)\n        external\n        onlyFlywheel\n        returns (Flywheel.Payout memory payout)\n    {\n        return _onWithdrawFunds(sender, campaign, token, hookData);\n    }\n\n    /// @notice Updates the campaign status\n    ///\n    /// @param campaign Address of the campaign\n    /// @param oldStatus Old status of the campaign\n    /// @param newStatus New status of the campaign\n    /// @param hookData Data for the campaign hook\n    ///\n    /// @dev Only callable by the flywheel contract\n    function onUpdateStatus(\n        address sender,\n        address campaign,\n        Flywheel.CampaignStatus oldStatus,\n        Flywheel.CampaignStatus newStatus,\n        bytes calldata hookData\n    ) external onlyFlywheel {\n        _onUpdateStatus(sender, campaign, oldStatus, newStatus, hookData);\n    }\n\n    /// @notice Updates the metadata for a campaign\n    ///\n    /// @param sender Address of the sender\n    /// @param campaign Address of the campaign\n    /// @param hookData Data for the campaign hook\n    ///\n    /// @dev Only callable by the flywheel contract\n    function onUpdateMetadata(address sender, address campaign, bytes calldata hookData) external onlyFlywheel {\n        _onUpdateMetadata(sender, campaign, hookData);\n    }\n\n    /// @notice Returns the URI for a campaign\n    ///\n    /// @param campaign Address of the campaign\n    /// @return uri The URI for the campaign\n    function campaignURI(address campaign) external view virtual returns (string memory uri);\n\n    /// @notice Creates a campaign in the hook\n    ///\n    /// @param campaign Address of the campaign\n    /// @param nonce Nonce used to create the campaign\n    /// @param hookData Data for the campaign hook\n    function _onCreateCampaign(address campaign, uint256 nonce, bytes calldata hookData) internal virtual;\n\n    /// @notice Processes immediate payouts for a campaign\n    ///\n    /// @param sender Address of the sender\n    /// @param campaign Address of the campaign\n    /// @param token Address of the token to be sent\n    /// @param hookData Data for the campaign hook\n    ///\n    /// @return payouts Array of payouts to be sent\n    /// @return immediateFees Array of fees to be send immediately\n    /// @return delayedFees Array of fees to be allocated and distributed later\n    function _onSend(address sender, address campaign, address token, bytes calldata hookData)\n        internal\n        virtual\n        returns (\n            Flywheel.Payout[] memory payouts,\n            Flywheel.Payout[] memory immediateFees,\n            Flywheel.Allocation[] memory delayedFees\n        )\n    {\n        revert Unsupported();\n    }\n\n    /// @notice Processes attribution for a campaign\n    ///\n    /// @param sender Address of the sender\n    /// @param campaign Address of the campaign\n    /// @param token Address of the token to be distributed\n    /// @param hookData Data for the campaign hook\n    ///\n    /// @return allocations Array of allocations to be distributed\n    function _onAllocate(address sender, address campaign, address token, bytes calldata hookData)\n        internal\n        virtual\n        returns (Flywheel.Allocation[] memory allocations)\n    {\n        revert Unsupported();\n    }\n\n    /// @notice Deallocates allocated rewards from a key for a campaign\n    ///\n    /// @param sender Address of the sender\n    /// @param campaign Address of the campaign\n    /// @param token Address of the token to deallocate from the key\n    /// @param hookData Data for the campaign hook\n    ///\n    /// @return allocations Array of allocations to be deallocated\n    function _onDeallocate(address sender, address campaign, address token, bytes calldata hookData)\n        internal\n        virtual\n        returns (Flywheel.Allocation[] memory allocations)\n    {\n        revert Unsupported();\n    }\n\n    /// @notice Distributes payouts for a campaign\n    ///\n    /// @param sender Address of the sender\n    /// @param campaign Address of the campaign\n    /// @param token Address of the token to be distributed\n    /// @param hookData Data for the campaign hook\n    ///\n    /// @return distributions Array of distributions to be distributed\n    /// @return immediateFees Array of fees to be sent immediately\n    /// @return delayedFees Array of fees to be allocated and distributed later\n    function _onDistribute(address sender, address campaign, address token, bytes calldata hookData)\n        internal\n        virtual\n        returns (\n            Flywheel.Distribution[] memory distributions,\n            Flywheel.Payout[] memory immediateFees,\n            Flywheel.Allocation[] memory delayedFees\n        )\n    {\n        revert Unsupported();\n    }\n\n    /// @notice Distribute fees earned from a campaign\n    ///\n    /// @param sender Address of the sender\n    /// @param campaign Address of the campaign\n    /// @param token Address of the token to collect fees from\n    /// @param hookData Data for the campaign hook\n    ///\n    /// @return distributions Array of distributions for the fees\n    function _onDistributeFees(address sender, address campaign, address token, bytes calldata hookData)\n        internal\n        virtual\n        returns (Flywheel.Distribution[] memory distributions)\n    {\n        revert Unsupported();\n    }\n\n    /// @notice Allows sponsor to withdraw remaining tokens from a finalized campaign\n    ///\n    /// @param sender Address of the sender\n    /// @param campaign Address of the campaign\n    /// @param token Address of the token to withdraw\n    /// @param hookData Data for the campaign hook\n    ///\n    /// @return payout The payout to be withdrawn\n    function _onWithdrawFunds(address sender, address campaign, address token, bytes calldata hookData)\n        internal\n        virtual\n        returns (Flywheel.Payout memory payout);\n\n    /// @notice Updates the campaign status\n    ///\n    /// @param campaign Address of the campaign\n    /// @param oldStatus Old status of the campaign\n    /// @param newStatus New status of the campaign\n    /// @param hookData Data for the campaign hook\n    function _onUpdateStatus(\n        address sender,\n        address campaign,\n        Flywheel.CampaignStatus oldStatus,\n        Flywheel.CampaignStatus newStatus,\n        bytes calldata hookData\n    ) internal virtual;\n\n    /// @notice Updates the metadata for a campaign\n    ///\n    /// @param sender Address of the sender\n    /// @param campaign Address of the campaign\n    /// @param hookData Data for the campaign hook\n    function _onUpdateMetadata(address sender, address campaign, bytes calldata hookData) internal virtual;\n}\n"
    }
}