{
    "vfp_id": "vfp_00506",
    "project_name": "Uniswap Calibur Audit.md",
    "findings": [
        {
            "id": 1,
            "category": {
                "1": [
                    "CWE-664"
                ],
                "2": [
                    "CWE-221"
                ],
                "3": [
                    "CWE-223"
                ]
            },
            "title": "Hooks Do Not Receive All Relevant Data",
            "description": "The hook system in the contract, designed to allow fine-grained validation logic, fails to pass critical execution data to certain hook functions. Specifically, the `handleAfterValidateUserOp` function does not receive the `validationData` parameter, which contains `validAfter`, `validUntil`, and `success` flags, and `handleAfterExecute` does not receive the call result or success status. This omission is caused by incomplete interface design in the hook contracts. An attacker or malicious relayer could exploit this lack of visibility by crafting transactions that pass validation but violate intended business logic that the hook cannot enforce due to missing data. The impact is reduced effectiveness of hook-based security controls, potentially allowing time-locked or conditional access rules to be bypassed, weakening the overall security model.\n",
            "severity": "Medium",
            "location": [
                "IValidationHook.sol::handleAfterValidateUserOp",
                "MinimalDelegation.sol::validateUserOp#122",
                "MinimalDelegation.sol::handleAfterExecute#195"
            ],
            "files": [
                "732a20a8d82f034573c6c7e44160f1860233a946/minimal-delegation/src/interfaces/IValidationHook.sol"
            ]
        }
    ],
    "affected_files": {
        "IValidationHook.sol": "// SPDX-License-Identifier: UNLICENSED\npragma solidity ^0.8.0;\n\nimport {PackedUserOperation} from \"account-abstraction/interfaces/PackedUserOperation.sol\";\n\n/// @title IValidationHook\n/// @notice Hook interface for optional signature validation logic\n/// @dev The keyHash is validated against the signature before each hook is called, but\n///      the hookData is NOT signed over or validated within the account. It MUST be treated as unsafe and can be set by anybody.\ninterface IValidationHook {\n    /// @notice Hook called after `validateUserOp` is called on the account by the entrypoint\n    /// @param keyHash the key which signed over userOpHash\n    /// @param userOp UserOperation\n    /// @param userOpHash hash of the UserOperation\n    /// @param hookData any data to be passed to the hook. This has NOT been validated by the user signature\n    /// @return selector Must be afterValidateUserOp.selector\n    /// @dev The hook can revert to prevent the UserOperation from being validated.\n    function afterValidateUserOp(\n        bytes32 keyHash,\n        PackedUserOperation calldata userOp,\n        bytes32 userOpHash,\n        bytes calldata hookData\n    ) external view returns (bytes4 selector);\n\n    /// @notice Hook called after verifying a signature over a digest in an EIP-1271 callback. \n    /// @dev MUST revert to signal that validation should fail\n    /// @param keyHash the key which signed over digest\n    /// @param digest the digest to verify\n    /// @param hookData any data to be passed to the hook.This has NOT been validated by the user signature\n    /// @return selector Must be afterIsValidSignature.selector\n    function afterIsValidSignature(bytes32 keyHash, bytes32 digest, bytes calldata hookData)\n        external\n        view\n        returns (bytes4 selector);\n\n    /// @notice Hook called after verifying a signature over `SignedBatchedCall`. \n    /// @dev MUST revert to signal that validation should fail\n    /// @param keyHash the key which signed over digest\n    /// @param digest the digest to verify\n    /// @param hookData any data to be passed to the hook. This has NOT been validated by the user signature\n    /// @return selector Must be afterVerifySignature.selector\n    function afterVerifySignature(bytes32 keyHash, bytes32 digest, bytes calldata hookData)\n        external\n        view\n        returns (bytes4 selector);\n}\n"
    }
}