{
    "vfp_id": "vfp_00452",
    "project_name": "ackee-blockchain-lido-csm-v2-report.pdf",
    "findings": [
        {
            "id": 9,
            "category": {
                "1": [
                    "CWE-707"
                ],
                "2": [
                    "CWE-20"
                ],
                "3": [
                    "CWE-1285"
                ],
                "4": [
                    "CWE-129"
                ]
            },
            "title": "W4: _validateKeyNumberValueIntervals in CSParametersRegistry does not check for empty arrays",
            "description": "The _validateKeyNumberValueIntervals function in CSParametersRegistry.sol accesses intervals[0] without first checking if the array is empty. This can lead to an out-of-bounds revert when an empty array is passed. The function is called by setRewardShareData and setPerformanceLeewayData, which also lack empty array checks. The root cause is insufficient input validation. This is a defensive programming issue that could cause unintended reverts during configuration updates, potentially disrupting protocol operations if exploited.\n",
            "severity": "Informational",
            "location": [
                "CSParametersRegistry.sol::_validateKeyNumberValueIntervals#766-786"
            ],
            "files": [
                "59dc7845660bef7299bf8cc97f9c831f5588a8ba/community-staking-module/src/CSParametersRegistry.sol"
            ]
        }
    ],
    "affected_files": {
        "CSParametersRegistry.sol": "// SPDX-FileCopyrightText: 2025 Lido <info@lido.fi>\n// SPDX-License-Identifier: GPL-3.0\n\npragma solidity 0.8.24;\n\nimport { AccessControlEnumerableUpgradeable } from \"@openzeppelin/contracts-upgradeable/access/extensions/AccessControlEnumerableUpgradeable.sol\";\nimport { Initializable } from \"@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol\";\nimport { SafeCast } from \"@openzeppelin/contracts/utils/math/SafeCast.sol\";\n\nimport { ICSParametersRegistry } from \"./interfaces/ICSParametersRegistry.sol\";\n\n/// @dev There are no upper limit checks except for the basis points (BP) values\n///      since with the introduction of Dual Governance any malicious changes to the parameters can be objected by stETH holders.\n// solhint-disable-next-line max-states-count\ncontract CSParametersRegistry is\n    ICSParametersRegistry,\n    Initializable,\n    AccessControlEnumerableUpgradeable\n{\n    using SafeCast for uint256;\n\n    /// @dev Maximal value for basis points (BP)\n    ///      1 BP = 0.01%\n    uint256 internal constant MAX_BP = 10000;\n\n    /// @dev QUEUE_LOWEST_PRIORITY identifies the range of available priorities: [0; QUEUE_LOWEST_PRIORITY].\n    uint256 public immutable QUEUE_LOWEST_PRIORITY;\n    /// @dev QUEUE_LEGACY_PRIORITY is the priority for the CSM v1 queue.\n    uint256 public immutable QUEUE_LEGACY_PRIORITY;\n\n    ////////////////////////\n    // State variables below\n    ////////////////////////\n\n    uint256 public defaultKeyRemovalCharge;\n    mapping(uint256 curveId => MarkedUint248) internal _keyRemovalCharges;\n\n    uint256 public defaultElRewardsStealingAdditionalFine;\n    mapping(uint256 curveId => MarkedUint248)\n        internal _elRewardsStealingAdditionalFines;\n\n    uint256 public defaultKeysLimit;\n    mapping(uint256 curveId => MarkedUint248) internal _keysLimits;\n\n    QueueConfig public defaultQueueConfig;\n    mapping(uint256 curveId => QueueConfig) internal _queueConfigs;\n\n    /// @dev Default value for the reward share. Can be only be set as a flat value due to possible sybil attacks\n    ///      Decreased reward share for some validators > N will promote sybils. Increased reward share for validators > N will give large operators an advantage\n    uint256 public defaultRewardShare;\n    mapping(uint256 curveId => KeyNumberValueInterval[])\n        internal _rewardShareData;\n\n    /// @dev Default value for the performance leeway. Can be only be set as a flat value due to possible sybil attacks\n    ///      Decreased performance leeway for some validators > N will promote sybils. Increased performance leeway for validators > N will give large operators an advantage\n    uint256 public defaultPerformanceLeeway;\n    mapping(uint256 curveId => KeyNumberValueInterval[])\n        internal _performanceLeewayData;\n\n    StrikesParams public defaultStrikesParams;\n    mapping(uint256 curveId => StrikesParams) internal _strikesParams;\n\n    uint256 public defaultBadPerformancePenalty;\n    mapping(uint256 curveId => MarkedUint248) internal _badPerformancePenalties;\n\n    PerformanceCoefficients public defaultPerformanceCoefficients;\n    mapping(uint256 curveId => PerformanceCoefficients)\n        internal _performanceCoefficients;\n\n    uint256 public defaultAllowedExitDelay;\n    mapping(uint256 => uint256) internal _allowedExitDelay;\n\n    uint256 public defaultExitDelayPenalty;\n    mapping(uint256 => MarkedUint248) internal _exitDelayPenalties;\n\n    uint256 public defaultMaxWithdrawalRequestFee;\n    mapping(uint256 => MarkedUint248) internal _maxWithdrawalRequestFees;\n\n    constructor(uint256 queueLowestPriority) {\n        if (queueLowestPriority == 0) {\n            revert ZeroQueueLowestPriority();\n        }\n\n        QUEUE_LOWEST_PRIORITY = queueLowestPriority;\n        QUEUE_LEGACY_PRIORITY = queueLowestPriority - 1;\n\n        _disableInitializers();\n    }\n\n    /// @notice initialize contract\n    function initialize(\n        address admin,\n        InitializationData calldata data\n    ) external initializer {\n        if (admin == address(0)) {\n            revert ZeroAdminAddress();\n        }\n\n        _setDefaultKeyRemovalCharge(data.keyRemovalCharge);\n        _setDefaultElRewardsStealingAdditionalFine(\n            data.elRewardsStealingAdditionalFine\n        );\n        _setDefaultKeysLimit(data.keysLimit);\n        _setDefaultRewardShare(data.rewardShare);\n        _setDefaultPerformanceLeeway(data.performanceLeeway);\n        _setDefaultStrikesParams(data.strikesLifetime, data.strikesThreshold);\n        _setDefaultBadPerformancePenalty(data.badPerformancePenalty);\n        _setDefaultPerformanceCoefficients(\n            data.attestationsWeight,\n            data.blocksWeight,\n            data.syncWeight\n        );\n        _setDefaultQueueConfig(\n            data.defaultQueuePriority,\n            data.defaultQueueMaxDeposits\n        );\n        _setDefaultAllowedExitDelay(data.defaultAllowedExitDelay);\n        _setDefaultExitDelayPenalty(data.defaultExitDelayPenalty);\n        _setDefaultMaxWithdrawalRequestFee(data.defaultMaxWithdrawalRequestFee);\n\n        __AccessControlEnumerable_init();\n\n        _grantRole(DEFAULT_ADMIN_ROLE, admin);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setDefaultKeyRemovalCharge(\n        uint256 keyRemovalCharge\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _setDefaultKeyRemovalCharge(keyRemovalCharge);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setDefaultElRewardsStealingAdditionalFine(\n        uint256 fine\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _setDefaultElRewardsStealingAdditionalFine(fine);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setDefaultKeysLimit(\n        uint256 limit\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _setDefaultKeysLimit(limit);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setDefaultRewardShare(\n        uint256 share\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _setDefaultRewardShare(share);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setDefaultPerformanceLeeway(\n        uint256 leeway\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _setDefaultPerformanceLeeway(leeway);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setDefaultStrikesParams(\n        uint256 lifetime,\n        uint256 threshold\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _setDefaultStrikesParams(lifetime, threshold);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setDefaultBadPerformancePenalty(\n        uint256 penalty\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _setDefaultBadPerformancePenalty(penalty);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setDefaultPerformanceCoefficients(\n        uint256 attestationsWeight,\n        uint256 blocksWeight,\n        uint256 syncWeight\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _setDefaultPerformanceCoefficients(\n            attestationsWeight,\n            blocksWeight,\n            syncWeight\n        );\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setDefaultQueueConfig(\n        uint256 priority,\n        uint256 maxDeposits\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _setDefaultQueueConfig(priority, maxDeposits);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setDefaultAllowedExitDelay(\n        uint256 delay\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _setDefaultAllowedExitDelay(delay);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setDefaultExitDelayPenalty(\n        uint256 penalty\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _setDefaultExitDelayPenalty(penalty);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setDefaultMaxWithdrawalRequestFee(\n        uint256 fee\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _setDefaultMaxWithdrawalRequestFee(fee);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setKeyRemovalCharge(\n        uint256 curveId,\n        uint256 keyRemovalCharge\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _keyRemovalCharges[curveId] = MarkedUint248(\n            keyRemovalCharge.toUint248(),\n            true\n        );\n        emit KeyRemovalChargeSet(curveId, keyRemovalCharge);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function unsetKeyRemovalCharge(\n        uint256 curveId\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        delete _keyRemovalCharges[curveId];\n        emit KeyRemovalChargeUnset(curveId);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setElRewardsStealingAdditionalFine(\n        uint256 curveId,\n        uint256 fine\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _elRewardsStealingAdditionalFines[curveId] = MarkedUint248(\n            fine.toUint248(),\n            true\n        );\n        emit ElRewardsStealingAdditionalFineSet(curveId, fine);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function unsetElRewardsStealingAdditionalFine(\n        uint256 curveId\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        delete _elRewardsStealingAdditionalFines[curveId];\n        emit ElRewardsStealingAdditionalFineUnset(curveId);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setKeysLimit(\n        uint256 curveId,\n        uint256 limit\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _keysLimits[curveId] = MarkedUint248(limit.toUint248(), true);\n        emit KeysLimitSet(curveId, limit);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function unsetKeysLimit(\n        uint256 curveId\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        delete _keysLimits[curveId];\n        emit KeysLimitUnset(curveId);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setRewardShareData(\n        uint256 curveId,\n        KeyNumberValueInterval[] calldata data\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _validateKeyNumberValueIntervals(data);\n        KeyNumberValueInterval[] storage intervals = _rewardShareData[curveId];\n        if (intervals.length > 0) {\n            delete _rewardShareData[curveId];\n        }\n        for (uint256 i = 0; i < data.length; ++i) {\n            intervals.push(data[i]);\n        }\n        emit RewardShareDataSet(curveId, data);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function unsetRewardShareData(\n        uint256 curveId\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        delete _rewardShareData[curveId];\n        emit RewardShareDataUnset(curveId);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setPerformanceLeewayData(\n        uint256 curveId,\n        KeyNumberValueInterval[] calldata data\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _validateKeyNumberValueIntervals(data);\n        KeyNumberValueInterval[] storage intervals = _performanceLeewayData[\n            curveId\n        ];\n        if (intervals.length > 0) {\n            delete _performanceLeewayData[curveId];\n        }\n        for (uint256 i = 0; i < data.length; ++i) {\n            intervals.push(data[i]);\n        }\n        emit PerformanceLeewayDataSet(curveId, data);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function unsetPerformanceLeewayData(\n        uint256 curveId\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        delete _performanceLeewayData[curveId];\n        emit PerformanceLeewayDataUnset(curveId);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setStrikesParams(\n        uint256 curveId,\n        uint256 lifetime,\n        uint256 threshold\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _validateStrikesParams(lifetime, threshold);\n        _strikesParams[curveId] = StrikesParams(\n            lifetime.toUint32(),\n            threshold.toUint32()\n        );\n        emit StrikesParamsSet(curveId, lifetime, threshold);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function unsetStrikesParams(\n        uint256 curveId\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        delete _strikesParams[curveId];\n        emit StrikesParamsUnset(curveId);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setBadPerformancePenalty(\n        uint256 curveId,\n        uint256 penalty\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _badPerformancePenalties[curveId] = MarkedUint248(\n            penalty.toUint248(),\n            true\n        );\n        emit BadPerformancePenaltySet(curveId, penalty);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function unsetBadPerformancePenalty(\n        uint256 curveId\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        delete _badPerformancePenalties[curveId];\n        emit BadPerformancePenaltyUnset(curveId);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setPerformanceCoefficients(\n        uint256 curveId,\n        uint256 attestationsWeight,\n        uint256 blocksWeight,\n        uint256 syncWeight\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _validatePerformanceCoefficients(\n            attestationsWeight,\n            blocksWeight,\n            syncWeight\n        );\n        _performanceCoefficients[curveId] = PerformanceCoefficients(\n            attestationsWeight.toUint32(),\n            blocksWeight.toUint32(),\n            syncWeight.toUint32()\n        );\n        emit PerformanceCoefficientsSet(\n            curveId,\n            attestationsWeight,\n            blocksWeight,\n            syncWeight\n        );\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function unsetPerformanceCoefficients(\n        uint256 curveId\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        delete _performanceCoefficients[curveId];\n        emit PerformanceCoefficientsUnset(curveId);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setQueueConfig(\n        uint256 curveId,\n        uint256 priority,\n        uint256 maxDeposits\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _validateQueueConfig(priority, maxDeposits);\n        _queueConfigs[curveId] = QueueConfig({\n            priority: priority.toUint32(),\n            maxDeposits: maxDeposits.toUint32()\n        });\n        emit QueueConfigSet(curveId, priority, maxDeposits);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function unsetQueueConfig(\n        uint256 curveId\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        delete _queueConfigs[curveId];\n        emit QueueConfigUnset(curveId);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setAllowedExitDelay(\n        uint256 curveId,\n        uint256 delay\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _validateAllowedExitDelay(delay);\n        _allowedExitDelay[curveId] = delay;\n        emit AllowedExitDelaySet(curveId, delay);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function unsetAllowedExitDelay(\n        uint256 curveId\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        delete _allowedExitDelay[curveId];\n        emit AllowedExitDelayUnset(curveId);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setExitDelayPenalty(\n        uint256 curveId,\n        uint256 penalty\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _exitDelayPenalties[curveId] = MarkedUint248(penalty.toUint248(), true);\n        emit ExitDelayPenaltySet(curveId, penalty);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function unsetExitDelayPenalty(\n        uint256 curveId\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        delete _exitDelayPenalties[curveId];\n        emit ExitDelayPenaltyUnset(curveId);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function setMaxWithdrawalRequestFee(\n        uint256 curveId,\n        uint256 fee\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        _maxWithdrawalRequestFees[curveId] = MarkedUint248(\n            fee.toUint248(),\n            true\n        );\n        emit MaxWithdrawalRequestFeeSet(curveId, fee);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function unsetMaxWithdrawalRequestFee(\n        uint256 curveId\n    ) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        delete _maxWithdrawalRequestFees[curveId];\n        emit MaxWithdrawalRequestFeeUnset(curveId);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function getKeyRemovalCharge(\n        uint256 curveId\n    ) external view returns (uint256 keyRemovalCharge) {\n        MarkedUint248 storage data = _keyRemovalCharges[curveId];\n        return data.isValue ? data.value : defaultKeyRemovalCharge;\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function getElRewardsStealingAdditionalFine(\n        uint256 curveId\n    ) external view returns (uint256 fine) {\n        MarkedUint248 storage data = _elRewardsStealingAdditionalFines[curveId];\n        return\n            data.isValue ? data.value : defaultElRewardsStealingAdditionalFine;\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function getKeysLimit(\n        uint256 curveId\n    ) external view returns (uint256 limit) {\n        MarkedUint248 storage data = _keysLimits[curveId];\n        return data.isValue ? data.value : defaultKeysLimit;\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function getRewardShareData(\n        uint256 curveId\n    ) external view returns (KeyNumberValueInterval[] memory data) {\n        data = _rewardShareData[curveId];\n        if (data.length == 0) {\n            data = new KeyNumberValueInterval[](1);\n            data[0] = KeyNumberValueInterval(1, defaultRewardShare);\n        }\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function getPerformanceLeewayData(\n        uint256 curveId\n    ) external view returns (KeyNumberValueInterval[] memory data) {\n        data = _performanceLeewayData[curveId];\n        if (data.length == 0) {\n            data = new KeyNumberValueInterval[](1);\n            data[0] = KeyNumberValueInterval(1, defaultPerformanceLeeway);\n        }\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function getStrikesParams(\n        uint256 curveId\n    ) external view returns (uint256 lifetime, uint256 threshold) {\n        StrikesParams storage params = _strikesParams[curveId];\n        if (params.threshold == 0) {\n            return (\n                defaultStrikesParams.lifetime,\n                defaultStrikesParams.threshold\n            );\n        }\n        return (params.lifetime, params.threshold);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function getBadPerformancePenalty(\n        uint256 curveId\n    ) external view returns (uint256 penalty) {\n        MarkedUint248 storage data = _badPerformancePenalties[curveId];\n        return data.isValue ? data.value : defaultBadPerformancePenalty;\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function getPerformanceCoefficients(\n        uint256 curveId\n    )\n        external\n        view\n        returns (\n            uint256 attestationsWeight,\n            uint256 blocksWeight,\n            uint256 syncWeight\n        )\n    {\n        PerformanceCoefficients storage coefficients = _performanceCoefficients[\n            curveId\n        ];\n        if (\n            coefficients.attestationsWeight == 0 &&\n            coefficients.blocksWeight == 0 &&\n            coefficients.syncWeight == 0\n        ) {\n            return (\n                defaultPerformanceCoefficients.attestationsWeight,\n                defaultPerformanceCoefficients.blocksWeight,\n                defaultPerformanceCoefficients.syncWeight\n            );\n        }\n        return (\n            coefficients.attestationsWeight,\n            coefficients.blocksWeight,\n            coefficients.syncWeight\n        );\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function getQueueConfig(\n        uint256 curveId\n    ) external view returns (uint32 queuePriority, uint32 maxDeposits) {\n        QueueConfig storage config = _queueConfigs[curveId];\n\n        if (config.maxDeposits == 0) {\n            return (\n                defaultQueueConfig.priority,\n                defaultQueueConfig.maxDeposits\n            );\n        }\n\n        return (config.priority, config.maxDeposits);\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function getAllowedExitDelay(\n        uint256 curveId\n    ) external view returns (uint256 delay) {\n        delay = _allowedExitDelay[curveId];\n        if (delay == 0) {\n            return defaultAllowedExitDelay;\n        }\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function getExitDelayPenalty(\n        uint256 curveId\n    ) external view returns (uint256 penalty) {\n        MarkedUint248 memory data = _exitDelayPenalties[curveId];\n        return data.isValue ? data.value : defaultExitDelayPenalty;\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function getMaxWithdrawalRequestFee(\n        uint256 curveId\n    ) external view returns (uint256 fee) {\n        MarkedUint248 memory data = _maxWithdrawalRequestFees[curveId];\n        return data.isValue ? data.value : defaultMaxWithdrawalRequestFee;\n    }\n\n    /// @inheritdoc ICSParametersRegistry\n    function getInitializedVersion() external view returns (uint64) {\n        return _getInitializedVersion();\n    }\n\n    function _setDefaultKeyRemovalCharge(uint256 keyRemovalCharge) internal {\n        defaultKeyRemovalCharge = keyRemovalCharge;\n        emit DefaultKeyRemovalChargeSet(keyRemovalCharge);\n    }\n\n    function _setDefaultElRewardsStealingAdditionalFine(uint256 fine) internal {\n        defaultElRewardsStealingAdditionalFine = fine;\n        emit DefaultElRewardsStealingAdditionalFineSet(fine);\n    }\n\n    function _setDefaultKeysLimit(uint256 limit) internal {\n        defaultKeysLimit = limit;\n        emit DefaultKeysLimitSet(limit);\n    }\n\n    function _setDefaultRewardShare(uint256 share) internal {\n        if (share > MAX_BP) {\n            revert InvalidRewardShareData();\n        }\n\n        defaultRewardShare = share;\n        emit DefaultRewardShareSet(share);\n    }\n\n    function _setDefaultPerformanceLeeway(uint256 leeway) internal {\n        if (leeway > MAX_BP) {\n            revert InvalidPerformanceLeewayData();\n        }\n\n        defaultPerformanceLeeway = leeway;\n        emit DefaultPerformanceLeewaySet(leeway);\n    }\n\n    function _setDefaultStrikesParams(\n        uint256 lifetime,\n        uint256 threshold\n    ) internal {\n        _validateStrikesParams(lifetime, threshold);\n        defaultStrikesParams = StrikesParams({\n            lifetime: lifetime.toUint32(),\n            threshold: threshold.toUint32()\n        });\n        emit DefaultStrikesParamsSet(lifetime, threshold);\n    }\n\n    function _setDefaultBadPerformancePenalty(uint256 penalty) internal {\n        defaultBadPerformancePenalty = penalty;\n        emit DefaultBadPerformancePenaltySet(penalty);\n    }\n\n    function _setDefaultPerformanceCoefficients(\n        uint256 attestationsWeight,\n        uint256 blocksWeight,\n        uint256 syncWeight\n    ) internal {\n        _validatePerformanceCoefficients(\n            attestationsWeight,\n            blocksWeight,\n            syncWeight\n        );\n        defaultPerformanceCoefficients = PerformanceCoefficients({\n            attestationsWeight: attestationsWeight.toUint32(),\n            blocksWeight: blocksWeight.toUint32(),\n            syncWeight: syncWeight.toUint32()\n        });\n        emit DefaultPerformanceCoefficientsSet(\n            attestationsWeight,\n            blocksWeight,\n            syncWeight\n        );\n    }\n\n    function _setDefaultQueueConfig(\n        uint256 priority,\n        uint256 maxDeposits\n    ) internal {\n        _validateQueueConfig(priority, maxDeposits);\n        defaultQueueConfig = QueueConfig({\n            priority: priority.toUint32(),\n            maxDeposits: maxDeposits.toUint32()\n        });\n        emit DefaultQueueConfigSet(priority, maxDeposits);\n    }\n\n    function _setDefaultAllowedExitDelay(uint256 delay) internal {\n        _validateAllowedExitDelay(delay);\n        defaultAllowedExitDelay = delay;\n        emit DefaultAllowedExitDelaySet(delay);\n    }\n\n    function _setDefaultExitDelayPenalty(uint256 penalty) internal {\n        defaultExitDelayPenalty = penalty;\n        emit DefaultExitDelayPenaltySet(penalty);\n    }\n\n    function _setDefaultMaxWithdrawalRequestFee(uint256 fee) internal {\n        defaultMaxWithdrawalRequestFee = fee;\n        emit DefaultMaxWithdrawalRequestFeeSet(fee);\n    }\n\n    function _validateQueueConfig(\n        uint256 priority,\n        uint256 maxDeposits\n    ) internal view {\n        if (\n            priority > QUEUE_LOWEST_PRIORITY ||\n            priority == QUEUE_LEGACY_PRIORITY\n        ) {\n            revert QueueCannotBeUsed();\n        }\n        if (maxDeposits == 0) {\n            revert ZeroMaxDeposits();\n        }\n    }\n\n    function _validateStrikesParams(\n        uint256 lifetime,\n        uint256 threshold\n    ) internal pure {\n        if (threshold == 0 || lifetime == 0) {\n            revert InvalidStrikesParams();\n        }\n    }\n\n    function _validateAllowedExitDelay(uint256 delay) internal pure {\n        if (delay == 0) {\n            revert InvalidAllowedExitDelay();\n        }\n    }\n\n    function _validatePerformanceCoefficients(\n        uint256 attestationsWeight,\n        uint256 blocksWeight,\n        uint256 syncWeight\n    ) internal pure {\n        if (attestationsWeight == 0 && blocksWeight == 0 && syncWeight == 0) {\n            revert InvalidPerformanceCoefficients();\n        }\n    }\n\n    function _validateKeyNumberValueIntervals(\n        KeyNumberValueInterval[] calldata intervals\n    ) private pure {\n        if (intervals[0].minKeyNumber != 1) {\n            revert InvalidKeyNumberValueIntervals();\n        }\n\n        if (intervals[0].value > MAX_BP) {\n            revert InvalidKeyNumberValueIntervals();\n        }\n\n        for (uint256 i = 1; i < intervals.length; ++i) {\n            unchecked {\n                if (\n                    intervals[i].minKeyNumber <= intervals[i - 1].minKeyNumber\n                ) {\n                    revert InvalidKeyNumberValueIntervals();\n                }\n                if (intervals[i].value > MAX_BP) {\n                    revert InvalidKeyNumberValueIntervals();\n                }\n            }\n        }\n    }\n}\n"
    }
}