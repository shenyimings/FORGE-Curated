{
    "vfp_id": "vfp_00588",
    "project_name": "blocksec_astherus_202502-signed.pdf",
    "findings": [
        {
            "id": 4,
            "category": {
                "1": [
                    "CWE-707"
                ],
                "2": [
                    "CWE-20"
                ]
            },
            "title": "Lack of non-zero check for key parameters",
            "description": "The initialize() function in AsBnbOFT.sol grants roles to addresses without validating that they are non-zero. This could allow critical roles to be assigned to the zero address, rendering the contract unusable or insecure. The root cause is missing input validation for critical parameters during initialization. An attacker could exploit this if they influence deployment parameters, leading to loss of control. The impact is potential permanent lockout of administrative functions or misrouting of privileges.\n",
            "severity": "Medium",
            "location": [
                "AsBnbOFT.sol::initialize"
            ],
            "files": [
                "61fc9f5610914cf94dddc3ab83e21ca22d388e92/ass-bnb-earn-contract/src/oft/AsBnbOFT.sol"
            ]
        }
    ],
    "affected_files": {
        "AsBnbOFT.sol": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.10;\n\nimport \"@layerzerolabs/oft-evm-upgradeable/contracts/oft/OFTUpgradeable.sol\";\nimport \"@openzeppelin/contracts-upgradeable/access/AccessControlUpgradeable.sol\";\nimport \"@openzeppelin/contracts-upgradeable/utils/PausableUpgradeable.sol\";\nimport \"@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol\";\nimport \"@openzeppelin/contracts-upgradeable/token/ERC20/extensions/ERC20PermitUpgradeable.sol\";\nimport { TransferLimiter } from \"./TransferLimiter.sol\";\n\ncontract AsBnbOFT is\n  OFTUpgradeable,\n  TransferLimiter,\n  ERC20PermitUpgradeable,\n  AccessControlUpgradeable,\n  PausableUpgradeable,\n  UUPSUpgradeable\n{\n  // pause role\n  bytes32 public constant PAUSER = keccak256(\"PAUSER\");\n  // manager role\n  bytes32 public constant MANAGER = keccak256(\"MANAGER\");\n\n  constructor(address _lzEndpoint) OFTUpgradeable(_lzEndpoint) {\n    _disableInitializers();\n  }\n\n  /**\n   * @dev Initializes the AsBnbOFT\n   * @param _admin The address of the admin.\n   * @param _manager The address of the manager.\n   * @param _pauser The address of the pauser.\n   * @param _delegate The delegate capable of making OApp configurations inside of the endpoint.\n   */\n  function initialize(\n    address _admin,\n    address _manager,\n    address _pauser,\n    string memory _name,\n    string memory _symbol,\n    address _delegate\n  ) external initializer {\n    __OFT_init(_name, _symbol, _delegate);\n    __Ownable_init(_delegate);\n    __AccessControl_init();\n    __Pausable_init();\n    __ERC20Permit_init(_name);\n    __UUPSUpgradeable_init();\n\n    _grantRole(DEFAULT_ADMIN_ROLE, _admin);\n    _grantRole(MANAGER, _manager);\n    _grantRole(PAUSER, _pauser);\n  }\n\n  /**\n   * @dev Credits user with the token if the contract is not paused.\n   * @param _to The address of the user to be credited.\n   * @param _amountLD The amount of tokens to be transferred.\n   * @return amountReceivedLD The actual amount of tokens received.\n   */\n  function _credit(\n    address _to,\n    uint256 _amountLD,\n    uint32 _srcEid\n  ) internal virtual override whenNotPaused returns (uint256 amountReceivedLD) {\n    return super._credit(_to, _amountLD, _srcEid);\n  }\n\n  /**\n   * @dev Checks and updates the rate limit before initiating a token transfer.\n   * @param _amountLD The amount of tokens to be transferred.\n   * @param _minAmountLD The minimum amount of tokens expected to be received.\n   * @param _dstEid The destination endpoint identifier.\n   * @return amountSentLD The actual amount of tokens sent.\n   * @return amountReceivedLD The actual amount of tokens received.\n   */\n  function _debit(\n    address _from,\n    uint256 _amountLD,\n    uint256 _minAmountLD,\n    uint32 _dstEid\n  ) internal virtual override whenNotPaused returns (uint256 amountSentLD, uint256 amountReceivedLD) {\n    // remove dust before checking\n    uint256 _amount = _removeDust(_amountLD);\n    _checkAndUpdateTransferLimit(_dstEid, _amount, _from);\n    return super._debit(_from, _amountLD, _minAmountLD, _dstEid);\n  }\n\n  /* ============================\n          Admin Functions\n  ============================ */\n  /**\n   * @dev Flips the pause state\n   */\n  function unpause() external onlyRole(MANAGER) {\n    _unpause();\n  }\n\n  /**\n   * @dev pause the contract\n   */\n  function pause() external onlyRole(PAUSER) {\n    _pause();\n  }\n\n  /**\n   * @dev Sets the transfer limit configurations based on TransferLimit array. Only callable by the owner or the rate limiter.\n   * @param _transferLimitConfigs An array of TransferLimit structures defining the transfer limits.\n   */\n  function setTransferLimitConfigs(TransferLimit[] calldata _transferLimitConfigs) external onlyRole(MANAGER) {\n    _setTransferLimitConfigs(_transferLimitConfigs);\n  }\n\n  /* ============================\n         Internal Functions\n  ============================ */\n  function _authorizeUpgrade(address newImplementation) internal override onlyRole(DEFAULT_ADMIN_ROLE) {}\n}\n"
    }
}