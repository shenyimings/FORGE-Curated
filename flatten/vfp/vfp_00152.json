{
    "vfp_id": "vfp_00152",
    "project_name": "Likwid - Zenith Audit Report.pdf",
    "findings": [
        {
            "id": 47,
            "category": {
                "1": [
                    "CWE-710"
                ],
                "2": [
                    "CWE-1041"
                ]
            },
            "title": "Unnecessary sign extension in marginFee()",
            "description": "The marginFee() function uses signextend() when extracting a uint24 value from packed storage, which is unnecessary for unsigned integers. The root cause is redundant operation. This has no functional impact but reduces code clarity. The impact is minor gas inefficiency and reduced readability.\n",
            "severity": "Informational",
            "location": [
                "Slot0Library.sol"
            ],
            "files": [
                "likwid-margin/src/types/Slot0.sol"
            ]
        }
    ],
    "affected_files": {
        "Slot0.sol": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.0;\n\ntype Slot0 is bytes32;\n\nusing Slot0Library for Slot0 global;\n\n/// @notice Library for getting and setting values in the Slot0 type\nlibrary Slot0Library {\n    uint128 internal constant MASK_128_BITS = 0x00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF;\n    uint32 internal constant MASK_32_BITS = 0xFFFFFFFF;\n    uint24 internal constant MASK_24_BITS = 0xFFFFFF;\n\n    uint8 internal constant LAST_UPDATED_OFFSET = 128;\n    uint8 internal constant PROTOCOL_FEE_OFFSET = 160;\n    uint8 internal constant LP_FEE_OFFSET = 184;\n    uint8 internal constant MARGIN_FEE_OFFSET = 208;\n\n    // #### GETTERS ####\n    function totalSupply(Slot0 _packed) internal pure returns (uint128 _totalSupply) {\n        assembly (\"memory-safe\") {\n            _totalSupply := and(MASK_128_BITS, _packed)\n        }\n    }\n\n    function lastUpdated(Slot0 _packed) internal pure returns (uint32 _timestampLast) {\n        assembly (\"memory-safe\") {\n            _timestampLast := and(MASK_32_BITS, shr(LAST_UPDATED_OFFSET, _packed))\n        }\n    }\n\n    function protocolFee(Slot0 _packed) internal pure returns (uint24 _protocolFee) {\n        assembly (\"memory-safe\") {\n            _protocolFee := and(MASK_24_BITS, shr(PROTOCOL_FEE_OFFSET, _packed))\n        }\n    }\n\n    function protocolFee(Slot0 _packed, uint24 defaultFee) internal pure returns (uint24 _protocolFee) {\n        _protocolFee = protocolFee(_packed);\n        _protocolFee = _protocolFee == 0 ? defaultFee : _protocolFee;\n    }\n\n    function lpFee(Slot0 _packed) internal pure returns (uint24 _lpFee) {\n        assembly (\"memory-safe\") {\n            _lpFee := and(MASK_24_BITS, shr(LP_FEE_OFFSET, _packed))\n        }\n    }\n\n    function marginFee(Slot0 _packed) internal pure returns (uint24 _marginFee) {\n        assembly (\"memory-safe\") {\n            _marginFee := signextend(2, shr(MARGIN_FEE_OFFSET, _packed))\n        }\n    }\n\n    // #### SETTERS ####\n    function setTotalSupply(Slot0 _packed, uint128 _totalSupply) internal pure returns (Slot0 _result) {\n        assembly (\"memory-safe\") {\n            _result := or(and(not(MASK_128_BITS), _packed), and(MASK_128_BITS, _totalSupply))\n        }\n    }\n\n    function setLastUpdated(Slot0 _packed, uint32 _lastUpdated) internal pure returns (Slot0 _result) {\n        assembly (\"memory-safe\") {\n            _result :=\n                or(\n                    and(not(shl(LAST_UPDATED_OFFSET, MASK_32_BITS)), _packed),\n                    shl(LAST_UPDATED_OFFSET, and(MASK_32_BITS, _lastUpdated))\n                )\n        }\n    }\n\n    function setProtocolFee(Slot0 _packed, uint24 _protocolFee) internal pure returns (Slot0 _result) {\n        assembly (\"memory-safe\") {\n            _result :=\n                or(\n                    and(not(shl(PROTOCOL_FEE_OFFSET, MASK_24_BITS)), _packed),\n                    shl(PROTOCOL_FEE_OFFSET, and(MASK_24_BITS, _protocolFee))\n                )\n        }\n    }\n\n    function setLpFee(Slot0 _packed, uint24 _lpFee) internal pure returns (Slot0 _result) {\n        assembly (\"memory-safe\") {\n            _result :=\n                or(and(not(shl(LP_FEE_OFFSET, MASK_24_BITS)), _packed), shl(LP_FEE_OFFSET, and(MASK_24_BITS, _lpFee)))\n        }\n    }\n\n    function setMarginFee(Slot0 _packed, uint24 _marginFee) internal pure returns (Slot0 _result) {\n        assembly (\"memory-safe\") {\n            _result :=\n                or(\n                    and(not(shl(MARGIN_FEE_OFFSET, MASK_24_BITS)), _packed),\n                    shl(MARGIN_FEE_OFFSET, and(MASK_24_BITS, _marginFee))\n                )\n        }\n    }\n}\n"
    }
}