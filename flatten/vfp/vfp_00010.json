{
    "vfp_id": "vfp_00010",
    "project_name": "ackee-blockchain-cow-flash-loan-router-report.pdf",
    "findings": [
        {
            "id": 3,
            "category": {},
            "title": "I3: Missing view in interfaces",
            "description": "1. **Description:** Several functions in the ICowSettlement.sol and IFlashLoanRouter.sol interfaces are missing the view modifier, despite clearly not modifying state.\n\n2. **Cause:** Omission of the view keyword in interface declarations, which reduces compiler-level enforcement of immutability and prevents optimization via staticcall.\n\n3. **Exploitation:** This cannot be exploited maliciously, but it may lead to incorrect tooling assumptions or missed gas optimizations when calling these functions.\n\n4. **Impact:** Reduced code clarity, potential for incorrect usage in implementations, and missed optimization opportunities. The issue was fixed by adding the view modifier in the updated interfaces.\n",
            "severity": "Informational",
            "location": [
                "ICowSettlement.sol::authenticator",
                "IFlashLoanRouter.sol::settlementContract",
                "IFlashLoanRouter.sol::settlementAuthentication"
            ],
            "files": [
                "flash-loan-router/src/interface/ICowSettlement.sol",
                "flash-loan-router/src/interface/IFlashLoanRouter.sol"
            ]
        }
    ],
    "affected_files": {
        "IFlashLoanRouter.sol": "// SPDX-License-Identifier: GPL-3.0-or-later\npragma solidity ^0.8;\n\nimport {Loan} from \"../library/Loan.sol\";\nimport {ICowAuthentication} from \"../vendored/ICowAuthentication.sol\";\nimport {ICowSettlement} from \"./ICowSettlement.sol\";\n\n/// @title Flash-loan Router Interface\n/// @author CoW DAO developers\n/// @notice Interface describing the functions available for interacting with\n/// the flash-loan router.\n/// @dev The flash loan router is intended to be a solver for CoW Protocol.\ninterface IFlashLoanRouter {\n    /// @notice Request all flash loan specified in the input and, after that,\n    /// executes the specified settlement.\n    /// @dev It's the solver's responsibility to make sure the loan is specified\n    /// correctly. The router contract offers no validation of the fact that\n    /// the flash loan proceeds are available for spending.\n    ///\n    /// The repayment of a flash loan is different based on the protocol. For\n    /// example, some expect to retrieve the funds from this borrower contract\n    /// through `transferFrom`, while other check the lender balance is as\n    /// expected after the flash loan has been processed. The executed\n    /// settlement must be built to cater to the needs of the specified lender.\n    ///\n    /// A settlement can be executed at most once in a call. The settlement\n    /// data cannot change during execution. Only the settle function can be\n    /// called. All of this is also the case if the lender is untrusted.\n    /// @param loans The list of flash loans to be requested before the\n    /// settlement is executed. The loans will be requested in the specified\n    /// order.\n    /// @param settlement The ABI-encoded bytes for a call to `settle()` (as\n    /// in `abi.encodeCall`).\n    function flashLoanAndSettle(Loan.Data[] calldata loans, bytes calldata settlement) external;\n\n    /// @notice Once a borrower has received the proceeds of a flash loan, it\n    /// calls back the router through this function.\n    /// @param encodedLoansWithSettlement The data the borrower received when\n    /// it was called, without any modification.\n    function borrowerCallBack(bytes calldata encodedLoansWithSettlement) external;\n\n    /// @notice The settlement contract supported by this router. This is the\n    /// contract that will be called when the settlement is executed.\n    function settlementContract() external returns (ICowSettlement);\n\n    /// @notice The settlement authenticator contract for CoW Protocol. This\n    /// contract determines who the solvers for CoW Protocol are.\n    function settlementAuthentication() external returns (ICowAuthentication);\n}\n",
        "ICowSettlement.sol": "// SPDX-License-Identifier: GPL-3.0-or-later\npragma solidity ^0.8;\n\n/// @notice An interface for CoW Protocol's settlement contract that only\n/// enumerates the functions and types needed for this project.\n/// For more information, see the project's repository:\n/// <https://github.com/cowprotocol/contracts/blob/9c1984b864d0a6703a877a088be6dac56450808c/src/contracts/GPv2Settlement.sol>\n/// The code and comments have been mostly copied from the linked resources.\ninterface ICowSettlement {\n    /// @notice A struct representing a trade to be executed as part a batch\n    /// settlement.\n    /// @dev See <https://github.com/cowprotocol/contracts/blob/9c1984b864d0a6703a877a088be6dac56450808c/src/contracts/libraries/GPv2Trade.sol#L14-L28>.\n    struct Trade {\n        uint256 sellTokenIndex;\n        uint256 buyTokenIndex;\n        address receiver;\n        uint256 sellAmount;\n        uint256 buyAmount;\n        uint32 validTo;\n        bytes32 appData;\n        uint256 feeAmount;\n        uint256 flags;\n        uint256 executedAmount;\n        bytes signature;\n    }\n\n    /// @notice Interaction data for performing arbitrary contract interactions.\n    /// Submitted to [`GPv2Settlement.settle`] for code execution.\n    /// @dev See <https://github.com/cowprotocol/contracts/blob/9c1984b864d0a6703a877a088be6dac56450808c/src/contracts/libraries/GPv2Interaction.sol#L7-L13>.\n    struct Interaction {\n        address target;\n        uint256 value;\n        bytes callData;\n    }\n\n    /// @notice The authenticator is used to determine who can call the settle\n    /// function. That is, only authorized solvers have the ability to invoke\n    /// settlements. Any valid authenticator implements an isSolver method\n    /// called by the onlySolver modifier below.\n    /// @dev See <https://github.com/cowprotocol/contracts/blob/9c1984b864d0a6703a877a088be6dac56450808c/src/contracts/GPv2Settlement.sol#L28-L32>.\n    function authenticator() external returns (address);\n\n    /// @notice Settle the specified orders at a clearing price. Note that it is\n    /// the responsibility of the caller to ensure that all GPv2 invariants are\n    /// upheld for the input settlement, otherwise this call will revert.\n    /// Namely:\n    /// - All orders are valid and signed\n    /// - Accounts have sufficient balance and approval.\n    /// - Settlement contract has sufficient balance to execute trades. Note\n    ///   this implies that the accumulated fees held in the contract can also\n    ///   be used for settlement. This is OK since:\n    ///   - Solvers need to be authorized\n    ///   - Misbehaving solvers will be slashed for abusing accumulated fees for\n    ///     settlement\n    ///   - Critically, user orders are entirely protected\n    ///\n    /// @param tokens An array of ERC20 tokens to be traded in the settlement.\n    /// Trades encode tokens as indices into this array.\n    /// @param clearingPrices An array of clearing prices where the `i`-th price\n    /// is for the `i`-th token in the [`tokens`] array.\n    /// @param trades Trades for signed orders.\n    /// @param interactions Smart contract interactions split into three\n    /// separate lists to be run before the settlement, during the settlement\n    /// and after the settlement respectively.\n    /// @dev See <https://github.com/cowprotocol/contracts/blob/9c1984b864d0a6703a877a088be6dac56450808c/src/contracts/GPv2Settlement.sol#L99-L126>.\n    function settle(\n        address[] calldata tokens,\n        uint256[] calldata clearingPrices,\n        Trade[] calldata trades,\n        Interaction[][3] calldata interactions\n    ) external;\n}\n"
    }
}