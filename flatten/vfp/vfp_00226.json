{
    "vfp_id": "vfp_00226",
    "project_name": "Enjoyoors EVM Vaults Security Audit Report.pdf",
    "findings": [
        {
            "id": 3,
            "category": {
                "1": [
                    "CWE-707"
                ],
                "2": [
                    "CWE-20"
                ],
                "3": [
                    "CWE-1287"
                ]
            },
            "title": "Need for ERC165 Check in the EnjoyoorsWithdrawalApprover",
            "description": "The _changeWithdrawalApprover function in the Setup contract allows updating the withdrawal approver address but does not validate that the new address implements the required interface via ERC165. The absence of this check could allow setting a contract that does not support necessary functions, leading to a broken or non-functional withdrawal approval system. While this is not directly exploitable for financial gain, it could result in a denial of service if an invalid contract is set. The impact is limited and preventable through operational care, hence the Low severity classification.\n",
            "severity": "Low",
            "location": [
                "Setup.sol::_changeWithdrawalApprover"
            ],
            "files": [
                "EnjoyoorsVault/contracts/vault/access/Setup.sol"
            ]
        }
    ],
    "affected_files": {
        "Setup.sol": "// SPDX-License-Identifier: BUSL-1.1\npragma solidity =0.8.26;\n\nimport '@openzeppelin/contracts/access/AccessControl.sol';\nimport '@openzeppelin/contracts/utils/introspection/IERC165.sol';\n\nimport '../EnjoyoorsVaultBase.sol';\nimport '../../libraries/Asserts.sol';\n\n/// @title Abstract contract for Enjoyoors vault settings\nabstract contract Setup is AccessControl, EnjoyoorsVaultBase {\n  using Asserts for address;\n\n  /// @notice Hash of role with changing contract params rights\n  bytes32 public constant SETUP_ROLE = keccak256('SETUP_ROLE');\n\n  /**\n   * @notice Emitted when maximum `token` capitalization limit was increased\n   * @param token Token which maximum capitalization limit was increased\n   * @param delta Value added to the limit\n   */\n  event SupplyLimitIncreased(address indexed token, uint256 delta);\n  /**\n   * @notice Emitted when maximum `token` capitalization limit was decreased\n   * @param token Token which maximum capitalization limit was decreased\n   * @param delta Value subtracted from the limit\n   */\n  event SupplyLimitDecreased(address indexed token, uint256 delta);\n  /**\n   * @notice Emitted when new minimal allowed deposit is set for `token`\n   * @param token Token which minimal deposit is changed\n   * @param _old Old minimal deposit amount\n   * @param _new New minimal deposit amount\n   */\n  event MinDepositChanged(address indexed token, uint256 _old, uint256 _new);\n  /**\n   * @notice Emitted when address of `EnjoyoorsWithdrawalApprover` contract was changed\n   * @param _old Old `EnjoyoorsWithdrawalApprover` contract address\n   * @param _new New `EnjoyoorsWithdrawalApprover` contract address\n   */\n  event WithdrawalApproverChanged(address _old, address _new);\n\n  /// @notice Revert reason if maximum token capitalization limit exceeds as the result of its decrease\n  /// @param supplyLeft Maximum value token capitalization can be decreased by\n  error SupplyLimitDecreaseFailed(uint256 supplyLeft);\n  /// @notice Revert reason if an attempt to set wrong `EnjoyoorsWithdrawalApprover` contract occurs\n  error WrongApproverAddress();\n\n  /**\n   * @notice Requires `SETUP_ROLE` rights. Increases listed `token` maximum capitalization\n   * @param token Token which maximum capitalization limit is increased\n   * @param delta Value to be added to the limit\n   */\n  function increaseSupplyLimit(address token, uint256 delta) external {\n    _increaseSupplyLimit(token, delta);\n  }\n\n  /**\n   * @notice Requires `SETUP_ROLE` rights. Decreases listed `token` maximum capitalization\n   * @param token Token which maximum capitalization limit is decreased\n   * @param delta Value to be subtracted from the limit\n   */\n  function decreaseSupplyLimit(address token, uint256 delta) external {\n    _decreaseSupplyLimit(token, delta);\n  }\n\n  /**\n   * @notice Requires `SETUP_ROLE` rights. Changes listed `token` minimal allowed deposit\n   * @param token Token which minimal allowed deposit amount is changed\n   * @param newMinDeposit New `token` minimal allowed deposit amount\n   */\n  function changeMinDeposit(address token, uint256 newMinDeposit) external {\n    _changeMinDeposit(token, newMinDeposit);\n  }\n\n  /**\n   * @notice Requires `SETUP_ROLE` rights. Changes `EnjoyoorsWithdrawalApprover` contract address\n   * @param newWithdrawalApprover new `EnjoyoorsWithdrawalApprover` contract address\n   */\n  function changeWithdrawalApprover(address newWithdrawalApprover) external {\n    _changeWithdrawalApprover(newWithdrawalApprover);\n  }\n\n  /**\n   * @notice Internal method with increasing capitalization limit implementation\n   * @param token Token which maximum capitalization limit is increased\n   * @param delta Value to be added to the limit\n   */\n  function _increaseSupplyLimit(address token, uint256 delta) private onlyRole(SETUP_ROLE) onlyWhitelistedToken(token) {\n    supplyTillLimit[token] += delta;\n    emit SupplyLimitIncreased(token, delta);\n  }\n\n  /**\n   * @notice Internal method with decreasing capitalization limit implementation\n   * @param token Token which maximum capitalization limit is decreased\n   * @param delta Value to be subtracted from the limit\n   */\n  function _decreaseSupplyLimit(address token, uint256 delta) private onlyRole(SETUP_ROLE) onlyWhitelistedToken(token) {\n    uint256 supplyLeft = supplyTillLimit[token];\n    if (supplyLeft < delta) revert SupplyLimitDecreaseFailed(supplyLeft);\n\n    supplyTillLimit[token] -= delta;\n    emit SupplyLimitDecreased(token, delta);\n  }\n\n  /**\n   * @notice Internal method with changing minimal allowed deposit implementation\n   * @param token Token which minimal allowed deposit amount is changed\n   * @param newMinDeposit New `token` minimal allowed deposit amount\n   */\n  function _changeMinDeposit(\n    address token,\n    uint256 newMinDeposit\n  ) private onlyRole(SETUP_ROLE) onlyWhitelistedToken(token) {\n    uint256 _old = minDeposit[token];\n    minDeposit[token] = newMinDeposit;\n    emit MinDepositChanged(token, _old, newMinDeposit);\n  }\n\n  /**\n   * @notice Internal method with implementation of `EnjoyoorsWithdrawalApprover` contract address replacement\n   * @param newWithdrawalApprover new `EnjoyoorsWithdrawalApprover` contract address\n   */\n  function _changeWithdrawalApprover(address newWithdrawalApprover) private onlyRole(SETUP_ROLE) {\n    newWithdrawalApprover.assertNotZeroAddress();\n    if (!IERC165(newWithdrawalApprover).supportsInterface(type(IEnjoyoorsWithdrawalApprover).interfaceId)) {\n      revert WrongApproverAddress();\n    }\n\n    address oldWithdrawalApprover = address(withdrawalApprover);\n    if (oldWithdrawalApprover == newWithdrawalApprover) revert WrongApproverAddress();\n\n    withdrawalApprover = IEnjoyoorsWithdrawalApprover(newWithdrawalApprover);\n    emit WithdrawalApproverChanged(oldWithdrawalApprover, newWithdrawalApprover);\n  }\n}\n"
    }
}