{
    "vfp_id": "vfp_00073",
    "project_name": "OIF Broadcaster Audit.md",
    "findings": [
        {
            "id": 2,
            "category": {
                "1": [
                    "CWE-707"
                ],
                "2": [
                    "CWE-20"
                ],
                "3": [
                    "CWE-1287"
                ]
            },
            "title": "Missing Version Validation",
            "description": "The `BlockHashProverPointer` contract does not validate the `version` function on the initial implementation when setting it for the first time. While subsequent updates require the new version to be greater than the old one, the first set operation skips this check. If the initial implementation does not implement the `version` function, any future attempt to update the implementation will fail when the contract tries to call `version()` on the old (non-conforming) implementation. This creates a permanent lockout scenario where the pointer cannot be upgraded, leading to a loss of upgradeability and potential system obsolescence if the initial prover becomes insecure or incompatible.\n",
            "severity": "Low",
            "location": [
                "BlockHashProverPointer.sol::setImplementationAddress#34-35",
                "BlockHashProverPointer.sol::setImplementationAddress#28-33"
            ],
            "files": [
                "3522b4c7c958ce254497b879cc1f6106131c7e3e/broadcaster/src/contracts/BlockHashProverPointer.sol"
            ]
        }
    ],
    "affected_files": {
        "BlockHashProverPointer.sol": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.27;\n\nimport {StorageSlot} from \"@openzeppelin/contracts/utils/StorageSlot.sol\";\nimport {Ownable} from \"@openzeppelin/contracts/access/Ownable.sol\";\nimport {IBlockHashProver} from \"./interfaces/IBlockHashProver.sol\";\nimport {IBlockHashProverPointer} from \"./interfaces/IBlockHashProverPointer.sol\";\n\nbytes32 constant BLOCK_HASH_PROVER_POINTER_SLOT = bytes32(uint256(keccak256(\"eip7888.pointer.slot\")) - 1);\n\ncontract BlockHashProverPointer is IBlockHashProverPointer, Ownable {\n    address internal _implementationAddress;\n\n    error NonIncreasingVersion(uint256 newVersion, uint256 oldVersion);\n\n    constructor(address _initialOwner) Ownable(_initialOwner) {}\n\n    function implementationAddress() public view returns (address) {\n        return _implementationAddress;\n    }\n\n    /// @notice Return the code hash of the latest version of the prover.\n    function implementationCodeHash() public view returns (bytes32 codeHash) {\n        codeHash = StorageSlot.getBytes32Slot(BLOCK_HASH_PROVER_POINTER_SLOT).value;\n    }\n\n    function setImplementationAddress(address _newImplementationAddress) external onlyOwner {\n        if(implementationAddress() !=  address(0)) {\n        uint256 newVersion = IBlockHashProver(_newImplementationAddress).version();\n        uint256 oldVersion = IBlockHashProver(implementationAddress()).version();\n        if (newVersion <= oldVersion) {\n            revert NonIncreasingVersion(newVersion, oldVersion);\n        }}\n        _implementationAddress = _newImplementationAddress;\n        _setCodeHash(_newImplementationAddress.codehash);\n    }\n\n    function _setCodeHash(bytes32 _codeHash) internal {\n        StorageSlot.getBytes32Slot(BLOCK_HASH_PROVER_POINTER_SLOT).value = _codeHash;\n    }\n}\n"
    }
}