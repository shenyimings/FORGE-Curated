{
    "vfp_id": "vfp_00470",
    "project_name": "cantina_coinbase_zora_creator_coin_sep2025.pdf",
    "findings": [
        {
            "id": 2,
            "category": {
                "1": [
                    "CWE-682"
                ],
                "2": [
                    "CWE-1339"
                ]
            },
            "title": "Creator coin vesting duration is 1.25 days less than expected",
            "description": "The CREATOR_VESTING_DURATION constant in CreatorCoinConstants is set to 5 * 365 days, which assumes a year has exactly 365 days and ignores leap years. The actual vesting period should account for leap years, as there is one every four years on average. The root cause is the use of an imprecise time calculation. This leads to the vesting period being 1.25 days shorter than the intended 5-year duration. While no direct exploitation is possible, the impact is a minor discrepancy in the vesting schedule, which could affect creator token claims and user expectations. The severity is low as the deviation is small and does not compromise security.\n",
            "severity": "Low",
            "location": [
                "CreatorCoin.sol#L65-L66",
                "CreatorCoinConstants.sol#L13"
            ],
            "files": [
                "zora-protocol/packages/coins/src/libs/CreatorCoinConstants.sol",
                "zora-protocol/packages/coins/src/CreatorCoin.sol"
            ]
        },
        {
            "id": 4,
            "category": {
                "1": [
                    "CWE-710"
                ],
                "2": [
                    "CWE-1041"
                ]
            },
            "title": "Duplicated and inconsistent constants across CoinConstants and MarketConstants",
            "description": "Constants such as POOL_LAUNCH_SUPPLY and CONTENT_COIN_MARKET_SUPPLY are duplicated across multiple libraries (CoinConstants, MarketConstants, CreatorCoinConstants), increasing the risk of inconsistency if one is updated and others are not. The root cause is poor code organization and lack of a single source of truth. This could lead to mismatches in token supply calculations or allocation logic during upgrades. The impact is informational, as it does not directly lead to exploits but reduces code maintainability and increases the likelihood of future bugs. The issue was partially fixed by consolidating constants, but dynamic relationships were not addressed.\n",
            "severity": "Informational",
            "location": [],
            "files": [
                "zora-protocol/packages/coins/src/libs/CoinConstants.sol",
                "zora-protocol/packages/coins/src/libs/MarketConstants.sol",
                "zora-protocol/packages/coins/src/libs/CreatorCoinConstants.sol"
            ]
        }
    ],
    "affected_files": {
        "CreatorCoinConstants.sol": "// SPDX-License-Identifier: ZORA-DELAYED-OSL-v1\n// This software is licensed under the Zora Delayed Open Source License.\n// Under this license, you may use, copy, modify, and distribute this software for\n// non-commercial purposes only. Commercial use and competitive products are prohibited\n// until the \"Open Date\" (3 years from first public distribution or earlier at Zora's discretion),\n// at which point this software automatically becomes available under the MIT License.\n// Full license terms available at: https://docs.zora.co/coins/license\npragma solidity ^0.8.23;\n\nlibrary CreatorCoinConstants {\n    uint256 internal constant TOTAL_SUPPLY = 1_000_000_000e18; // 1b coins\n    uint256 internal constant CREATOR_VESTING_SUPPLY = 500_000_000e18; // 500m coins\n    uint256 internal constant CREATOR_VESTING_DURATION = 5 * 365 days; // 5 years\n    address internal constant CURRENCY = 0x1111111111166b7FE7bd91427724B487980aFc69;\n}\n",
        "CreatorCoin.sol": "// SPDX-License-Identifier: ZORA-DELAYED-OSL-v1\n// This software is licensed under the Zora Delayed Open Source License.\n// Under this license, you may use, copy, modify, and distribute this software for\n// non-commercial purposes only. Commercial use and competitive products are prohibited\n// until the \"Open Date\" (3 years from first public distribution or earlier at Zora's discretion),\n// at which point this software automatically becomes available under the MIT License.\n// Full license terms available at: https://docs.zora.co/coins/license\npragma solidity ^0.8.28;\n\nimport {ICreatorCoin} from \"./interfaces/ICreatorCoin.sol\";\nimport {CreatorCoinConstants} from \"./libs/CreatorCoinConstants.sol\";\nimport {IHooks, PoolConfiguration, PoolKey, ICoin} from \"./interfaces/ICoin.sol\";\nimport {IPoolManager} from \"@uniswap/v4-core/src/interfaces/IPoolManager.sol\";\nimport {BaseCoin} from \"./BaseCoin.sol\";\nimport {IHasCoinType} from \"./interfaces/ICoin.sol\";\nimport {MarketConstants} from \"./libs/MarketConstants.sol\";\n\ncontract CreatorCoin is ICreatorCoin, BaseCoin {\n    uint256 public vestingStartTime;\n    uint256 public vestingEndTime;\n    uint256 public totalClaimed;\n\n    constructor(\n        address protocolRewardRecipient_,\n        address protocolRewards_,\n        IPoolManager poolManager_,\n        address airlock_\n    ) BaseCoin(protocolRewardRecipient_, protocolRewards_, poolManager_, airlock_) initializer {}\n\n    function totalSupplyForPositions() external pure override returns (uint256) {\n        return MarketConstants.CREATOR_COIN_MARKET_SUPPLY;\n    }\n\n    function coinType() external pure override returns (IHasCoinType.CoinType) {\n        return IHasCoinType.CoinType.Creator;\n    }\n\n    function initialize(\n        address payoutRecipient_,\n        address[] memory owners_,\n        string memory tokenURI_,\n        string memory name_,\n        string memory symbol_,\n        address platformReferrer_,\n        address currency_,\n        PoolKey memory poolKey_,\n        uint160 sqrtPriceX96,\n        PoolConfiguration memory poolConfiguration_\n    ) public override(BaseCoin, ICoin) {\n        require(currency_ == CreatorCoinConstants.CURRENCY, InvalidCurrency());\n\n        super.initialize({\n            payoutRecipient_: payoutRecipient_,\n            owners_: owners_,\n            tokenURI_: tokenURI_,\n            name_: name_,\n            symbol_: symbol_,\n            platformReferrer_: platformReferrer_,\n            currency_: currency_,\n            poolKey_: poolKey_,\n            sqrtPriceX96: sqrtPriceX96,\n            poolConfiguration_: poolConfiguration_\n        });\n\n        vestingStartTime = block.timestamp;\n        vestingEndTime = block.timestamp + CreatorCoinConstants.CREATOR_VESTING_DURATION;\n    }\n\n    /// @dev The initial mint and distribution of the coin supply.\n    ///      Implements creator coin specific distribution: 500M to liquidity pool, 500M vested to creator.\n    function _handleInitialDistribution() internal override {\n        _mint(address(this), CreatorCoinConstants.TOTAL_SUPPLY);\n\n        _transfer(address(this), address(poolKey.hooks), MarketConstants.CREATOR_COIN_MARKET_SUPPLY);\n    }\n\n    /// @notice Allows the creator payout recipient to claim vested tokens\n    /// @dev Optimized for frequent calls from Uniswap V4 hooks\n    /// @return claimAmount The amount of tokens claimed\n    function claimVesting() external returns (uint256) {\n        uint256 claimAmount = getClaimableAmount();\n\n        // Early return if nothing to claim (gas efficient for frequent calls)\n        if (claimAmount == 0) {\n            return 0;\n        }\n\n        // Update total claimed before transfer\n        totalClaimed += claimAmount;\n\n        // Transfer directly to the payout recipient\n        _transfer(address(this), payoutRecipient, claimAmount);\n\n        emit CreatorVestingClaimed(payoutRecipient, claimAmount, totalClaimed, vestingStartTime, vestingEndTime);\n\n        return claimAmount;\n    }\n\n    /// @notice Get currently claimable amount without claiming\n    /// @return The amount that can be claimed right now\n    function getClaimableAmount() public view returns (uint256) {\n        uint256 vestedAmount = _calculateVestedAmount(block.timestamp);\n        return vestedAmount > totalClaimed ? vestedAmount - totalClaimed : 0;\n    }\n\n    /// @notice Calculate total vested amount at given timestamp\n    /// @param timestamp The timestamp to calculate vesting for\n    /// @return The total amount vested at the given timestamp\n    function _calculateVestedAmount(uint256 timestamp) internal view returns (uint256) {\n        // Before vesting starts\n        if (timestamp <= vestingStartTime) {\n            return 0;\n        }\n\n        // After vesting ends - fully vested\n        if (timestamp >= vestingEndTime) {\n            return CreatorCoinConstants.CREATOR_VESTING_SUPPLY;\n        }\n\n        // Linear vesting: (elapsed_time / total_duration) * total_amount\n        uint256 elapsedTime = timestamp - vestingStartTime;\n\n        // Multiply first to avoid precision loss\n        return (CreatorCoinConstants.CREATOR_VESTING_SUPPLY * elapsedTime) / CreatorCoinConstants.CREATOR_VESTING_DURATION;\n    }\n}\n",
        "CoinConstants.sol": "// SPDX-License-Identifier: ZORA-DELAYED-OSL-v1\n// This software is licensed under the Zora Delayed Open Source License.\n// Under this license, you may use, copy, modify, and distribute this software for\n// non-commercial purposes only. Commercial use and competitive products are prohibited\n// until the \"Open Date\" (3 years from first public distribution or earlier at Zora's discretion),\n// at which point this software automatically becomes available under the MIT License.\n// Full license terms available at: https://docs.zora.co/coins/license\npragma solidity ^0.8.23;\n\nlibrary CoinConstants {\n    /// @notice The maximum total supply\n    /// @dev Set to 1 billion coins with 18 decimals\n    uint256 public constant MAX_TOTAL_SUPPLY = 1_000_000_000e18;\n\n    /// @notice The number of coins allocated to the liquidity pool\n    /// @dev 990 million coins\n    uint256 public constant POOL_LAUNCH_SUPPLY = 990_000_000e18;\n\n    /// @notice The number of coins rewarded to the creator\n    /// @dev 10 million coins\n    uint256 public constant CREATOR_LAUNCH_REWARD = 10_000_000e18;\n\n    /// @notice The minimum order size allowed for trades\n    /// @dev Set to 0.0000001 ETH to prevent dust transactions\n    uint256 public constant MIN_ORDER_SIZE = 0.0000001 ether;\n\n    int24 internal constant DEFAULT_DISCOVERY_TICK_LOWER = -777000;\n    int24 internal constant DEFAULT_DISCOVERY_TICK_UPPER = 222000;\n    uint16 internal constant DEFAULT_NUM_DISCOVERY_POSITIONS = 10; // will be 11 total with tail position\n    uint256 internal constant DEFAULT_DISCOVERY_SUPPLY_SHARE = 0.495e18; // half of the 990m total pool supply\n}\n",
        "MarketConstants.sol": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.23;\n\nlibrary MarketConstants {\n    /// @dev Constant used to increase precision during calculations\n    uint256 internal constant WAD = 1e18;\n\n    /// @notice The number of coins allocated to the liquidity pool for content coins\n    /// @dev 990 million coins\n    uint256 internal constant CONTENT_COIN_MARKET_SUPPLY = 990_000_000 * WAD;\n\n    /// @notice The number of coins allocated to the liquidity pool for creator coins\n    /// @dev 500 million coins\n    uint256 internal constant CREATOR_COIN_MARKET_SUPPLY = 500_000_000 * WAD;\n\n    /// @notice The LP fee\n    /// @dev 10000 basis points = 1%\n    uint24 internal constant LP_FEE_V4 = 10_000;\n\n    /// @notice The spacing for 1% pools\n    /// @dev 200 ticks\n    int24 internal constant TICK_SPACING = 200;\n}\n"
    }
}