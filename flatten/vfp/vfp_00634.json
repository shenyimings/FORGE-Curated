{
    "vfp_id": "vfp_00634",
    "project_name": "ChainSecurity_K3Capital_SBOLD_Audit.pdf",
    "findings": [
        {
            "id": 15,
            "category": {
                "1": [
                    "CWE-710"
                ],
                "2": [
                    "CWE-684"
                ],
                "3": [
                    "CWE-440"
                ]
            },
            "title": "Incorrect Transient Storage Slot",
            "description": "The TransientStorage.loadCollValue() function uses COLLATERAL_IN_BOLD_STORAGE instead of COLLATERAL_VALUE_STORAGE for the transient storage slot. The root cause is a constant misuse. Although the return value is not used internally, this affects the public calcFragments() view function, potentially returning incorrect data. The impact is low, limited to incorrect view data, but could mislead off-chain systems relying on accurate collateral valuation.\n",
            "severity": "Low",
            "location": [
                "TransientStorage.sol::loadCollValue",
                "sBold.sol::calcFragments"
            ],
            "files": [
                "sBOLD/contracts/libraries/helpers/TransientStorage.sol"
            ]
        }
    ],
    "affected_files": {
        "TransientStorage.sol": "// SPDX-License-Identifier: GPL-2.0-or-later\npragma solidity ^0.8.24;\n\nimport {TransientSlot} from \"@openzeppelin/contracts/utils/TransientSlot.sol\";\n\n/// @title Transient storage\n/// @notice Library for loading and storing data in transient storage.\nlibrary TransientStorage {\n    using TransientSlot for *;\n\n    // keccak256(abi.encode(uint256(keccak256(\"sBold.collateralInBold\")) - 1)) & ~bytes32(uint256(0xff))\n    bytes32 internal constant COLLATERAL_IN_BOLD_STORAGE =\n        0x93de9a8576a62ce59fcb637d8053d0e5fadcf7d26694489a7981d83007528a00;\n    // keccak256(abi.encode(uint256(keccak256(\"sBold.collateralValue\")) - 1)) & ~bytes32(uint256(0xff))\n    bytes32 internal constant COLLATERAL_VALUE_STORAGE =\n        0xb9119c9d507ab94e0f4429b4c7bbf0463ef7a3523c74e225b6641cfb04e67a00;\n    // keccak256(abi.encode(uint256(keccak256(\"sBold.collateralInBoldFlag\")) - 1)) & ~bytes32(uint256(0xff))\n    bytes32 internal constant COLLATERALS_FLAG_STORAGE =\n        0x7f4a0d96299dae48c93382764b8799886298548aad0eae1e31f8351df5706900;\n\n    /// @dev Stores the collateral values in transient storage.\n    /// @param collValue The collateral in USD value to be stored.\n    /// @param collInBold The collateral in $BOLD value to be stored.\n    function storeCollValues(uint256 collValue, uint256 collInBold) internal {\n        // Transient store for collateral in $BOLD flag\n        COLLATERALS_FLAG_STORAGE.asBoolean().tstore(true);\n        // Transient store for collateral in USD\n        COLLATERAL_VALUE_STORAGE.asUint256().tstore(collValue);\n        // Transient store for collateral in $BOLD\n        COLLATERAL_IN_BOLD_STORAGE.asUint256().tstore(collInBold);\n    }\n\n    /// @dev Clears the collateral in $BOLD value from transient storage.\n    function switchOffCollInBoldFlag() internal {\n        COLLATERALS_FLAG_STORAGE.asBoolean().tstore(false);\n    }\n\n    /// @dev Loads the collaterals flag from transient storage.\n    /// @return The boolean flag.\n    function loadCollsFlag() internal view returns (bool) {\n        return COLLATERALS_FLAG_STORAGE.asBoolean().tload();\n    }\n\n    /// @dev Loads the collateral in $BOLD value from transient storage.\n    /// @return The value.\n    function loadCollInBold() internal view returns (uint256) {\n        return COLLATERAL_IN_BOLD_STORAGE.asUint256().tload();\n    }\n\n    /// @dev Loads the collateral in USD value from transient storage.\n    /// @return The value.\n    function loadCollValue() internal view returns (uint256) {\n        return COLLATERAL_VALUE_STORAGE.asUint256().tload();\n    }\n}\n"
    }
}