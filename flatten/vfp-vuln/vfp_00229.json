{
    "vfp_id": "vfp_00229",
    "project_name": "SSO Account Abstraction Audit.md",
    "findings": [
        {
            "id": 4,
            "category": {
                "1": [
                    "CWE-693"
                ]
            },
            "title": "Storage Slot Collision with Clave Protocol",
            "description": "The `SsoStorage` library uses a storage slot that is identical to one used by the Clave protocol, which could lead to storage collisions if both protocols are deployed in the same environment or if future upgrades are not carefully managed. This occurs because the storage slot was derived from a hash that coincides with Clave's implementation, likely due to insufficient uniqueness in the hashing input. An attacker or conflicting protocol could overwrite critical state variables in the SsoAccount contract by writing to the same storage slot, potentially leading to corruption of account state or unauthorized behavior. The impact includes loss of state integrity and potential compromise of account functionality.\n",
            "severity": "High",
            "location": [
                "SsoStorage.sol#7",
                "https://github.com/getclave/clave-contracts/blob/0719581143537dde145291a6ea45ac308c2d0f6c/contracts/libraries/ClaveStorage.sol#L7"
            ],
            "files": [
                "zksync-sso-clave-contracts/src/libraries/SsoStorage.sol"
            ]
        }
    ],
    "affected_files": {
        "SsoStorage.sol": "// SPDX-License-Identifier: GPL-3.0\npragma solidity ^0.8.24;\n\nimport { EnumerableSet } from \"@openzeppelin/contracts/utils/structs/EnumerableSet.sol\";\n\nlibrary SsoStorage {\n  bytes32 private constant SSO_STORAGE_SLOT = 0x3248da1aeae8bd923cbf26901dc4bfc6bb48bb0fbc5b6102f1151fe7012884f4;\n\n  struct Layout {\n    // ┌───────────────────┐\n    // │   Ownership Data  │\n    EnumerableSet.AddressSet k1Owners;\n    uint256[50] __gap_0;\n    // └───────────────────┘\n\n    // ┌───────────────────┐\n    // │     Validation    │\n    EnumerableSet.AddressSet moduleValidators;\n    uint256[50] __gap_2;\n    // └───────────────────┘\n\n    // ┌───────────────────┐\n    // │       Hooks       │\n    EnumerableSet.AddressSet validationHooks;\n    EnumerableSet.AddressSet executionHooks;\n    uint256[50] __gap_4;\n    // └───────────────────┘\n  }\n\n  function layout() internal pure returns (Layout storage l) {\n    bytes32 slot = SSO_STORAGE_SLOT;\n    assembly {\n      l.slot := slot\n    }\n  }\n}\n"
    }
}