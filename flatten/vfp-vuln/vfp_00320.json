{
    "vfp_id": "vfp_00320",
    "project_name": "Sorella - Zenith Audit Report.pdf",
    "findings": [
        {
            "id": 1,
            "category": {
                "1": [
                    "CWE-693"
                ]
            },
            "title": "AFTER_SWAP_RETURNS_DELTA_FLAG isn't turned on",
            "description": "The afterSwap() function is designed to return the protocol swap fee, but the afterSwapReturnDelta flag is not enabled in the hook configuration. As a result, the PoolManager does not parse the return value from afterSwap, treating it as zero and failing to apply the intended fee. This misconfiguration stems from the permissions structure in the hook setup, where the flag is omitted despite the function's return value being critical for fee enforcement. An attacker could exploit this by performing swaps that should incur protocol fees, but due to the unprocessed return value, no fee is charged. The impact is a loss of expected protocol revenue and potential economic imbalance in fee distribution.\n",
            "severity": "High",
            "location": [
                "hook-config.sol#L17-L19",
                "AngstromL2.sol#L284"
            ],
            "files": [
                "l2-angstrom/src/hook-config.sol"
            ]
        }
    ],
    "affected_files": {
        "hook-config.sol": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.0;\n\nimport {Hooks} from \"v4-core/src/libraries/Hooks.sol\";\n\nbool constant POOLS_MUST_HAVE_DYNAMIC_FEE = false;\n\nfunction getRequiredHookPermissions() pure returns (Hooks.Permissions memory permissions) {\n    permissions.beforeInitialize = true; // To constrain that this is an ETH pool\n\n    permissions.afterAddLiquidity = true; // To tax liquidity additions that may be JIT\n    permissions.afterAddLiquidityReturnDelta = true; // To charge the JIT liquidity MEV tax.\n\n    permissions.afterRemoveLiquidity = true; // To tax liquidity removals that may be JIT\n    permissions.afterRemoveLiquidityReturnDelta = true; // To charge the JIT liquidity MEV tax.\n\n    permissions.beforeSwap = true; // To tax ToB\n    permissions.afterSwap = true; // Also to tax with ToB (after swap contains reward dist. calculations)\n    permissions.beforeSwapReturnDelta = true; // To charge the ToB MEV tax.\n}\n"
    }
}