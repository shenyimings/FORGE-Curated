{
    "vfp_id": "vfp_00103",
    "project_name": "Frax0 Mesh - Zellic Audit Report.pdf",
    "findings": [
        {
            "id": 0,
            "category": {
                "1": [
                    "CWE-682"
                ],
                "2": [
                    "CWE-1339"
                ]
            },
            "title": "Incorrect condition for determining dust removal",
            "description": "The RemoteCustodian contract fails to remove dust from share amounts when the custodian token's decimals are less than or equal to six, due to a conditional check based on custodianTknDecimals() rather than the frxUSD token's decimals. This causes inconsistencies in cross-chain transfers where dust is not properly handled, leading to discrepancies between deposited assets and received shares. An attacker could exploit this by crafting deposits with dust that get rounded up during conversion but not properly accounted for during transfer, resulting in the contract holding more assets than the corresponding shares justify. This leads to a loss of user funds and incorrect accounting in cross-chain operations.\n",
            "severity": "Medium",
            "location": [
                "RemoteCustodian.sol::_removeDustFrxUsdFloor",
                "RemoteCustodian.sol::_removeDustFrxUsdCeil",
                "RemoteCustodian.sol::_convertToAssets",
                "RemoteCustodian.sol::previewMint",
                "RemoteCustodian.sol::mint",
                "RemoteCustodian.sol::_convertToShares",
                "RemoteCustodian.sol::previewDeposit"
            ],
            "files": [
                "b8d76da3a2bb5ff1fc557c194f8fe6496873959d/frax-oft-upgradeable/contracts/frxUsd/SFrxUSDOFTUpgradeable.sol"
            ]
        }
    ],
    "affected_files": {
        "SFrxUSDOFTUpgradeable.sol": "// SPDX-License-Identifier: UNLICENSED\npragma solidity ^0.8.22;\n\nimport { OFTUpgradeable } from \"@fraxfinance/layerzero-v2-upgradeable/oapp/contracts/oft/OFTUpgradeable.sol\";\nimport { SendParam } from \"@fraxfinance/layerzero-v2-upgradeable/oapp/contracts/oft/interfaces/IOFT.sol\";\n\nimport {EIP3009Module} from \"contracts/modules/EIP3009Module.sol\";\nimport {PermitModule} from \"contracts/modules/PermitModule.sol\";\n\nimport {ERC20Upgradeable} from \"@openzeppelin/contracts-upgradeable/token/ERC20/ERC20Upgradeable.sol\";\n\ncontract SFrxUSDOFTUpgradeable is OFTUpgradeable, EIP3009Module, PermitModule {\n    constructor(address _lzEndpoint) OFTUpgradeable(_lzEndpoint) {\n        _disableInitializers();\n    }\n\n   function version() public pure returns (string memory) {\n        return \"1.1.0\";\n    }\n\n    // Admin\n    /// @dev This method is called specifically when upgrading an existing OFT\n    function initializeV110() external reinitializer(3) {\n        __EIP712_init(name(), version());\n    }\n\n\n    function name() public pure override returns (string memory) {\n        return \"Staked Frax USD\";\n    }\n\n    function symbol() public pure override returns (string memory) {\n        return \"sfrxUSD\";\n    }\n\n    // Helper views\n\n    function toLD(uint64 _amountSD) external view returns (uint256 amountLD) {\n        return _toLD(_amountSD);\n    }\n\n    function toSD(uint256 _amountLD) external view returns (uint64 amountSD) {\n        return _toSD(_amountLD);\n    }\n\n    function removeDust(uint256 _amountLD) public view returns (uint256 amountLD) {\n        return _removeDust(_amountLD);\n    }\n\n    function debitView(uint256 _amountLD, uint256 _minAmountLD, uint32 _dstEid) external view returns (uint256 amountSentLD, uint256 amountReceivedLD) {\n        /// @dev: _dstEid is unused in _debitView\n        return _debitView(_amountLD, _minAmountLD, _dstEid);\n    }\n\n    function buildMsgAndOptions(\n        SendParam calldata _sendParam,\n        uint256 _amountLD\n    ) external view returns (bytes memory message, bytes memory options) {\n        return _buildMsgAndOptions(_sendParam, _amountLD);\n    }\n\n    //==============================================================================\n    // Overrides\n    //==============================================================================\n\n    /// @dev supports EIP3009\n    function _transfer(address from, address to, uint256 amount) internal override(EIP3009Module, ERC20Upgradeable) {\n        return ERC20Upgradeable._transfer(from, to, amount);\n    }\n\n    /// @dev supports EIP2612\n    function _approve(address owner, address spender, uint256 amount) internal override(PermitModule, ERC20Upgradeable) {\n        return ERC20Upgradeable._approve(owner, spender, amount);\n    }\n}\n"
    }
}