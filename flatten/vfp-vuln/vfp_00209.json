{
    "vfp_id": "vfp_00209",
    "project_name": "Linea Burn Mechanism Audit.md",
    "findings": [
        {
            "id": 0,
            "category": {
                "1": [
                    "CWE-664"
                ],
                "2": [
                    "CWE-404"
                ],
                "3": [
                    "CWE-772"
                ]
            },
            "title": "Partial Swaps Can Lead to Permanently Locked Funds",
            "description": "The V3DexSwap contract is designed to swap ETH for LINEA tokens using a Uniswap V3-style DEX. It accepts a _sqrtPriceLimitX96 parameter that can cause a partial swap if the price limit is reached during execution. The root cause of the vulnerability is the contract's failure to handle leftover WETH after a partial swap. After converting received ETH to WETH and performing the swap, any unswapped WETH remains in the contract's balance. Since there are no functions to withdraw or transfer these leftover tokens, they become permanently locked and irrecoverable. An attacker could exploit this by triggering a swap under market conditions that cause the price limit to be hit, ensuring a partial execution. The impact is the permanent loss of funds, reducing the protocol's revenue and undermining trust in the system's financial integrity.\n",
            "severity": "Medium",
            "location": [
                "V3DexSwap.sol::swap#L70-L71"
            ],
            "files": [
                "linea-monorepo/contracts/src/operational/V3DexSwap.sol"
            ]
        }
    ],
    "affected_files": {
        "V3DexSwap.sol": "// SPDX-License-Identifier: Apache-2.0 OR MIT\npragma solidity 0.8.30;\n\nimport { IV3DexSwap } from \"./interfaces/IV3DexSwap.sol\";\nimport { ISwapRouterV3 } from \"./interfaces/ISwapRouterV3.sol\";\nimport { IWETH9 } from \"./interfaces/IWETH9.sol\";\n\n/**\n * @title V3DexSwap.\n * @dev A contract for swapping tokens on a decentralized exchange.\n * @author Consensys Software Inc.\n * @custom:security-contact security-report@linea.build\n */\ncontract V3DexSwap is IV3DexSwap {\n  /// @notice Tick spacing of the pool.\n  uint24 public immutable POOL_TICK_SPACING;\n  /// @notice Address of the Swap Router contract.\n  address public immutable ROUTER;\n  /// @notice Address of the WETH token contract.\n  address public immutable WETH_TOKEN;\n  /// @notice Address of the LINEA token contract.\n  address public immutable LINEA_TOKEN;\n\n  /**\n   * @dev Initializes the contract with the given parameters.\n   * @param _router Address of the Router contract.\n   * @param _wethToken Address of the WETH token contract.\n   * @param _lineaToken Address of the LINEA token contract.\n   * @param _poolTickSpacing Tick spacing of the pool.\n   */\n  constructor(address _router, address _wethToken, address _lineaToken, uint24 _poolTickSpacing) {\n    require(_router != address(0), ZeroAddressNotAllowed());\n    require(_wethToken != address(0), ZeroAddressNotAllowed());\n    require(_lineaToken != address(0), ZeroAddressNotAllowed());\n    require(_poolTickSpacing > 0, ZeroTickSpacingNotAllowed());\n\n    ROUTER = _router;\n    WETH_TOKEN = _wethToken;\n    LINEA_TOKEN = _lineaToken;\n    POOL_TICK_SPACING = _poolTickSpacing;\n  }\n\n  /** @notice Swap ETH into LINEA tokens.\n   * @dev The msg.sender will be the recipient of the LINEA tokens, and WETH is swapped 1:1 with `msg.value`.\n   * @dev No ETH is kept in the contract after the swap due to exactInputSingle swapping.\n   * @param _minLineaOut Minimum number of LINEA tokens to receive (slippage protection).\n   * @param _deadline Time after which the transaction will revert if not yet processed.\n   * @param _sqrtPriceLimitX96 Price limit of the swap as a Q64.96 value.\n   */\n  function swap(\n    uint256 _minLineaOut,\n    uint256 _deadline,\n    uint160 _sqrtPriceLimitX96\n  ) external payable returns (uint256 amountOut) {\n    require(msg.value > 0, NoEthSend());\n    require(_deadline > block.timestamp, DeadlineInThePast());\n    require(_minLineaOut > 0, ZeroMinLineaOutNotAllowed());\n\n    IWETH9(WETH_TOKEN).deposit{ value: msg.value }();\n    IWETH9(WETH_TOKEN).approve(ROUTER, msg.value);\n\n    amountOut = ISwapRouterV3(ROUTER).exactInputSingle(\n      ISwapRouterV3.ExactInputSingleParams({\n        tokenIn: WETH_TOKEN,\n        tokenOut: LINEA_TOKEN,\n        tickSpacing: POOL_TICK_SPACING,\n        recipient: msg.sender,\n        deadline: _deadline,\n        amountIn: msg.value,\n        amountOutMinimum: _minLineaOut,\n        sqrtPriceLimitX96: _sqrtPriceLimitX96\n      })\n    );\n  }\n}\n"
    }
}