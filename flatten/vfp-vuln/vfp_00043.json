{
    "vfp_id": "vfp_00043",
    "project_name": "cantina_byzantine_sep2025.pdf",
    "findings": [
        {
            "id": 0,
            "category": {
                "1": [
                    "CWE-697"
                ],
                "2": [
                    "CWE-1023"
                ]
            },
            "title": "Anyone can overwrite factory mapping",
            "description": "The CompoundV3AdapterFactory stores deployed adapter addresses in a mapping keyed only by parentVault and comet, excluding the cometRewards parameter. This allows any user to deploy a new adapter with the same parentVault and comet but a different cometRewards address, overwriting the existing mapping entry. The root cause is the insufficient key structure in the mapping, which fails to account for all configuration parameters. An attacker could exploit this by deploying a malicious adapter with altered reward logic, causing downstream systems relying on the mapping to interact with the wrong or malicious contract. While the contract is not directly used by other audited contracts, external integrators may be misled, potentially leading to fund loss. Due to the uncertain scope of impact, it is classified as medium risk despite high exploit likelihood.\n",
            "severity": "Medium",
            "location": [
                "CompoundV3AdapterFactory.sol#L23"
            ],
            "files": [
                "debt-fund-vault-v2/src/adapters/CompoundV3AdapterFactory.sol"
            ]
        }
    ],
    "affected_files": {
        "CompoundV3AdapterFactory.sol": "// SPDX-License-Identifier: GPL-2.0-or-later\n// Copyright (c) 2025 [Byzantine Finance]\n// The implementation of this contract was inspired by Morpho Vault V2, developed by the Morpho Association in 2025.\npragma solidity 0.8.28;\n\nimport {CompoundV3Adapter} from \"./CompoundV3Adapter.sol\";\nimport {ICompoundV3AdapterFactory} from \"./interfaces/ICompoundV3AdapterFactory.sol\";\n\ncontract CompoundV3AdapterFactory is ICompoundV3AdapterFactory {\n    /* STORAGE */\n\n    mapping(address => mapping(address => address)) public compoundV3Adapter;\n    mapping(address => bool) public isCompoundV3Adapter;\n\n    /* FUNCTIONS */\n\n    /// @dev Returns the address of the deployed CompoundV3Adapter.\n    function createCompoundV3Adapter(address parentVault, address comet, address cometRewards)\n        external\n        returns (address)\n    {\n        address _compoundV3Adapter = address(new CompoundV3Adapter{salt: bytes32(0)}(parentVault, comet, cometRewards));\n        compoundV3Adapter[parentVault][comet] = _compoundV3Adapter;\n        isCompoundV3Adapter[_compoundV3Adapter] = true;\n        emit CreateCompoundV3Adapter(parentVault, comet, cometRewards, _compoundV3Adapter);\n        return _compoundV3Adapter;\n    }\n}\n"
    }
}